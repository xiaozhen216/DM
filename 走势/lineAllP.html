<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>货量趋势图</title>

	<script type="text/javascript" src="core.js"></script>
	<script type="text/javascript" src="../framework/ajax.js"></script>	
	<script type="text/javascript" src="js/jquery-1.10.1.min.js"></script>
	<script type="text/javascript" src="js/highcharts.js"></script>
  <script src="js/exporting.js"></script>
	<script type="text/javascript">

	var serviceUrl = "../display/json/226";
	
	function query() {

    var fromDate = $$("fromDate").value;
    var toDate = $$("toDate").value;
		var whichProv = $$("whichProv").value;

		Ajax({
			url : serviceUrl,
			method : "POST",
			params : {"param1": fromDate, "param2": toDate, "param3": whichProv},
			type : "json",
			waiting : true,
			ondata : function() {
				var data = eval(this.getResponseText());
				show(data);
				/*if( result == null ) {	 
					return ;
				}*/
			}
		});	  
	}

	function GetUnique(inputArray)
{
    var outputArray = [];
    
    for (var i = 0; i < inputArray.length; i++)
    {
        if ((jQuery.inArray(inputArray[i], outputArray)) == -1)
        {
            outputArray.push(inputArray[i]);
        }
    }
   
    return outputArray;
}

	function show(originData) {
		var totalIn = 0;
		var totalOut = 0;
		var dataW = [];
		var dataDay = [];
		var showDay = [];
		var maxdataIn = 0;
		var maxcenut = 0;
		var maxDayIn = 0;
		var maxDayOut = 0;
		var scaledata = 0;
		var spaceData = 0;
    var center = '';
    var j = 1;
    var k = 1;
    var s = 0;
    var day = 0;
    var cen = [];
    var cenW = [];

    cen[0] = 'a';
    dataDay[0] = '1'; 

		for(var i = 0; i < originData.length; i++) {

			center = originData[i]["分拨"];
      day = originData[i]["日期"];
      



      
      if (center != cen[j-1]) {        
        cen[j] = center;
        j++;
      };
      
      if (day != dataDay[k-1]) {        
        dataDay[k] = day;
        k++;
      };
    };

    for (var m = 0; m < dataDay.length; m++) {
        cenW[m] = new Array();
        for (var n = 0; n < cen.length; n++) {
            cenW[m][n] = 0;
        };
    };

    for(var i = 0; i < originData.length; i++) {
      var weightIn = originData[i]["入网重量"];
      var centerIn = originData[i]["分拨"];
			var dateIn = originData[i]["日期"];

      for (p = 0; p < dataDay.length; p++) {
          if (dateIn == dataDay[p]) {
              for (var q = 0; q < cen.length; q++) {                        
                      if (centerIn == cen[q]) {
                          cenW[p][q] = weight;                          
                          break;
                      }; 
              };                       
              break;  
          }          
      };

			if (maxdataIn<weightIn) {
				maxdataIn = weightIn;
				maxDayIn = dateIn
			}
			
			if (maxdataIn/100<1) {scaledata=Math.ceil(maxdataIn/10) * 10;}
			scaledata=Math.ceil(maxdataIn/100) * 100;

			/*if (i % Math.round(originData.length/10) == 0){
				showDay[i] = dateIn;
			}
			else{
				showDay[i] = ' ';
			}*/
			totalIn += weightIn;

		};

    for (var r = 0; r < dataDay.length; r++) {
      for (var s = 0; s < cen.length; s++) {
        dataw[r][s] = {name: cen[r],data: cenW[r][s]}; 
      };
    };


		spaceData=scaledata/5;
				
       $(function () {
                $('#container').highcharts({
                    title: {
                        text: 'Monthly Average Temperature',
                        x: -20 //center
                    },
                    subtitle: {
                        text: 'Source: WorldClimate.com',
                        x: -20
                    },
                    xAxis: {
                        categories: dataDay
                    },
                    yAxis: {
                        title: {
                            text: 'Temperature (째C)'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        valueSuffix: '째C'
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle',
                        borderWidth: 0
                    },
                    series: [{
                        name: 'New York',
                        data: [0.2, 1.8, 5.7, 1.3, 17.0, 2.0, 14.8, 24.1, 20.1, 14.1, 8.6, 2.5]
                    }, {
                        name: 'New York',
                        data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
                    }, {
                        name: 'Berlin',
                        data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
                    }, {
                        name: 'London',
                        data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
                    }]
                });
            });		

		}
	
	</script>
</head>

<body>
	
	<form method="get" target='hiddenFrame'>
		日期从: <input type="date" id="fromDate"/>  到:  <input type="date" id="toDate"/>&nbsp;
    所属省份：<select id="whichProv">
            <option>北京分公司</option>
            <option>江苏分公司</option>
            <option>广东分公司</option>
            <option>浙江分公司</option>
            <option>上海分公司</option>
            <option>河北分公司</option>
            <option>天津分公司</option>
            <option>安徽分公司</option>
            <option>福建分公司</option>
            <option>云南分公司</option>
        </select>&nbsp;
		<input type="submit" onclick="query()" value="查询"/>
	</form>
	<iframe width='0px' height='0px' name='hiddenFrame'></iframe>
	
	<div id='container'></div>

</body>
</html>